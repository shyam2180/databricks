on:
  push:
    branches:
      - main
 
jobs:
  build:
    runs-on: ubuntu-latest
 
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
 
    - name: Install Databricks CLI
      run: |
        pip install databricks-cli

    - name: Configure Databricks CLI
      run: |
          echo -e "${{ secrets.DATABRICKS_HOST }}\n${{ secrets.DATABRICKS_TOKEN }}" | databricks configure --token
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    - name: Debug Token and Host
      run: |
        echo "DATABRICKS_TOKEN=${{ secrets.DATABRICKS_TOKEN }}"
        echo "DATABRICKS_HOST=${{ secrets.DATABRICKS_HOST }}"

    - name: Verify Databricks CLI Configuration
      run: cat $HOME/.databrickscfg
 
    - name: Upload Notebook to Databricks
      run: |
        # Replace '/Workspace/Folder/Path' with the actual path in your Databricks workspace
        # Replace 'local/path/to/your/notebook' with the actual path to your notebook file
        
        # Set variables for Databricks workspace and local notebook path
        DATABRICKS_PATH="/Users/shyamkumarr@jmangroup.com/cicd"
        LOCAL_NOTEBOOK_PATH="C:\\Users\\ShyamKumarR\\OneDrive - JMAN Group Ltd\\Desktop\\test_cicd_output\\ci_cd.py"
        
        # Import notebook to Databricks workspace
        databricks workspace import -l PYTHON "$DATABRICKS_PATH" "$LOCAL_NOTEBOOK_PATH"

    - name: Run Databricks Notebook
      run: |
        databricks workspace create --name 'MyJob' --folder '/Workspace/Folder/Path' --format SOURCE --language SOURCE --overwrite
        databricks jobs run-now --job-id <job-id> # Use the actual job ID
